# 函数实现

## new

```javascript
function new_(constructor){
  	res = {};
  	res.__proto__ = constructor.prototype;
    construcotr.call(res, Array.prototype.slice.call(arguments, 1));
    return res;
}
```



## instanceof

```javascript
function instanceof(left, right){
  	let proto = left.__proto__
    let p = right.prototype
    while (true){
      	if (proto == null) return false;
      	if (proto == p) return true;
      	proto = proto.__proto__
    }
}
```



> typeof 原理:
>
> typeof 基本可以返回正确的类型，除了 typeof null == object, typeof([]) == object
>
> typeof 的实现原理是查看底层的二进制，js 的底层二进制表示中，前三位用来表示其属于的类型。前三位都是0的就表示对象，而 null 为全0，所以返回也为对象
>
> *  000：对象
> * 1: 整数
> * 010：浮点数
> * 100：字符串
> * 110：布尔
>
> js 的 number 表示使用IEEE754 标准，采用双精度存储，占用64bit，其中1位符号位，11位指数位，52位尾数位置，当出现循环二进制，例如0.1，0 .2这样的，就会对于超出位数的精度进行截断，造成精度丢失。



## Call

```javascript
Function.prototype.myCall = function(obj){
  	obj = obj || window;
  	obj.fn = this;
  	let res = obj.fn(...Array.from(arguments).slice(1));
  	delete obj.fn;
  	return res;
}
```



## Apply

```javascript
Function.prototype.myApply = function(obj){
  	obj = obj || window;
  	obj.fn = this;
  	let res = null;
  	if (arguments.length <=1){
				res = obj.fn()
		}
  	else{
				let arg = arguments[1];
      	res = obj.fn(...arg);
		}
		delete obj.fn;
		return res;
  
}
```



## Bind

```javascript
Function.prototype.myBind = function(obj){
  	obj = obj || window;
  	obj.fn = this;
  	let arg = Array.from(arguments).slice(1);
  	return function(){
				let res = obj.fn(...arg, ...arguments);
      	delete obj.fn;
      	return res;
		}
}
```



## Flat

js本身是带有flat 这个方法的，在 Array.prototype 上

```javascript
let arr = [1, [2, 3, [4, 5, [12, 3, "zs"], 7, [8, 9, [10, 11, [1, 2, [3, 4]]]]]]];
arr.flat(Infinity)
>> [1, 2, 3, 4, 5, 12, 3, "zs", 7, 8, 9, 10, 11, 1, 2, 3, 4]
```

自己写一个

```javascript
Array.prototype.myFlat = function(){
		let res = [];
  	this.forEach(item =>{
				if (Array.isArray(item)){
						res.push(...item.myFlat())
				}else{
						res.push(item)
				}
		});
  	return res
}
```



## Promise 实现的SetTimeout

```javascript
let setTout = function(time, cb){
		return new Promise((resolve, reject)=>{
					let end = new Date().getTime();
      		while (new Date().getTime() < end){}
					resolve();
		}).then(success=>{
					cb();
			})
}

setTout(3000, ()=>console.log('Timeout'));
// 3s后输出 Timeout
```

